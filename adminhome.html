<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maya Hive â€¢ Admin Dashboard</title>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #d19361 0%, #e2e0e4 100%);
            min-height: 100vh;
            display: flex;
            color: #333;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background: #ffffffaa;
            backdrop-filter: blur(10px);
            padding: 25px;
            box-shadow: 4px 0 15px rgba(0,0,0,0.15);
        }

        .sidebar h2 {
            margin-bottom: 30px;
            font-size: 1.6rem;
            color: #000;
            text-align: center;
        }

        .nav-item {
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: 0.2s;
        }

        .nav-item:hover {
            background: #d36b16;
            color: white;
        }

        /* Main Content */
        .main {
            flex: 1;
            padding: 30px;
        }

        .header {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 25px;
            text-shadow: 1px 1px rgba(0,0,0,0.15);
        }

        /* Overview Cards */
        .cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            transition: 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
        }

        .card h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #444;
        }

        .card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #d36b16;
        }

        /* Table */
        .section-title {
            font-size: 1.3rem;
            margin: 25px 0 15px;
            font-weight: bold;
            color: #000;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
        }

        table th, table td {
            padding: 14px 18px;
            border-bottom: 1px solid #eee;
        }

        table th {
            background: #e96f0b;
            color: white;
            text-align: left;
            font-size: 0.95rem;
        }

        table tr:hover td {
            background: #fff5eb;
        }

        .empty {
            text-align: center;
            padding: 20px;
            color: #777;
        }

        /* Admin management */
        .admin-section {
            margin-top: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .admin-form, .admin-list {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.12);
        }

        .admin-form h3, .admin-list h3 {
            margin-bottom: 12px;
        }

        .form-row {
            margin-bottom: 12px;
        }

        .form-row label {
            display: block;
            font-weight: 600;
            margin-bottom: 6px;
            color: #444;
        }

        .form-row input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-family: inherit;
            transition: 0.2s;
        }

        .form-row input:focus {
            outline: none;
            border-color: #d36b16;
            box-shadow: 0 0 0 3px rgba(211,107,22,0.15);
        }

        .btn {
            width: 100%;
            border: none;
            border-radius: 8px;
            padding: 12px 16px;
            font-weight: 700;
            cursor: pointer;
            background: linear-gradient(135deg, #d36b16 0%, #dd600d 100%);
            color: white;
            transition: 0.2s ease;
        }

        .btn:hover { transform: translateY(-1px); }

        .btn.secondary {
            background: #f0f0f0;
            color: #333;
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 14px;
            margin-top: 10px;
        }

        .admin-card {
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 16px;
            background: #fafafa;
            position: relative;
        }

        .admin-card h4 {
            margin-bottom: 6px;
        }

        .admin-meta {
            font-size: 0.95rem;
            color: #555;
            margin: 4px 0;
        }

        .chip {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            background: #fff4ec;
            color: #d36b16;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .card-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .small-btn {
            flex: 1;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            font-weight: 600;
        }

        .small-btn.edit { color: #0b4f8a; border-color: #b3d4f3; }
        .small-btn.remove { color: #a11; border-color: #f3c3c3; }

        .status {
            margin-top: 8px;
            font-weight: 600;
            font-size: 0.95rem;
        }

        .status.error { color: #a11; }
        .status.success { color: #0a7b3b; }

        @media (max-width: 900px) {
            .admin-section {
                grid-template-columns: 1fr;
            }
        }

        /* Employee management */
        .management-section {
            margin-top: 30px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .employee-list, .employee-form {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.12);
        }

        .employee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 14px;
            margin-top: 10px;
        }

        .employee-card {
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 16px;
            background: #fdf8f3;
        }

        .employee-card h4 { margin-bottom: 6px; }
        .employee-card .meta { color: #555; font-size: 0.95rem; margin: 4px 0; }

        .pill {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            background: #e8f4ff;
            color: #0b4f8a;
            font-weight: 700;
            font-size: 0.85rem;
        }

        @media (max-width: 900px) {
            .management-section {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <!-- SIDEBAR -->
    <div class="sidebar">
        <h2>Admin Panel</h2>

        <div class="nav-item">Dashboard</div>
        <div class="nav-item">Employees</div>
        <div class="nav-item">Admins</div>
        <div class="nav-item">Roles</div>
        <div class="nav-item">Activity Log</div>
        <div class="nav-item">Profile</div>
        <div class="nav-item">Logout</div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main">
        <div class="header">Welcome, Admin</div>

        <!-- Overview Cards -->
        <div class="cards">
            <div class="card">
                <h3>Total Employees</h3>
                <div class="value" id="totalEmployees">0</div>
            </div>

            <div class="card">
                <h3>Total Admins</h3>
                <div class="value" id="totalAdmins">0</div>
            </div>

            <div class="card">
                <h3>Departments</h3>
                <div class="value" id="totalDepartments">0</div>
            </div>

            <div class="card">
                <h3>Recent Logins</h3>
                <div class="value" id="recentLogins">0</div>
            </div>
        </div>

        <!-- Latest Employees -->
        <div class="section-title">Recently Added Employees</div>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Department</th>
                    <th>DOB</th>
                </tr>
            </thead>
            <tbody id="employeeTable">
                <tr><td colspan="4" class="empty">Loading...</td></tr>
            </tbody>
        </table>

        <!-- Activity Log -->
        <div class="section-title">Admin Activity Log</div>
        <table>
            <thead>
                <tr>
                    <th>Admin</th>
                    <th>Action</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="activityLog">
                <tr><td colspan="3" class="empty">No activity found</td></tr>
            </tbody>
        </table>

        <!-- Employee Management -->
        <div class="section-title">Manage Employees</div>
        <div class="management-section">
            <div class="employee-form">
                <h3 id="employeeFormTitle">Add Employee</h3>
                <div id="employeeFormStatus" class="status"></div>
                <form id="employeeForm">
                    <div class="form-row">
                        <label for="empName">Full name</label>
                        <input type="text" id="empName" name="name" placeholder="Jane Doe" required>
                    </div>
                    <div class="form-row">
                        <label for="empEmail">Email</label>
                        <input type="email" id="empEmail" name="email" placeholder="jane@example.com" required>
                    </div>
                    <div class="form-row">
                        <label for="empPhone">Phone</label>
                        <input type="tel" id="empPhone" name="phone" placeholder="1234567890" required>
                    </div>
                    <div class="form-row">
                        <label for="empDepartment">Department</label>
                        <input type="text" id="empDepartment" name="department" placeholder="Engineering" required>
                    </div>
                    <div class="form-row">
                        <label for="empDob">Date of Birth</label>
                        <input type="date" id="empDob" name="dateOfBirth" required>
                    </div>
                    <div class="form-row">
                        <button type="submit" class="btn" id="employeeSubmitBtn">Add Employee</button>
                    </div>
                    <div class="form-row" id="employeeCancelRow" style="display:none;">
                        <button type="button" class="btn secondary" id="employeeCancelBtn">Cancel edit</button>
                    </div>
                </form>
            </div>

            <div class="employee-list">
                <h3>Employee list</h3>
                <div id="employeeListStatus" class="status"></div>
                <div id="employeeGrid" class="employee-grid">
                    <div class="empty">Loading employees...</div>
                </div>
            </div>
        </div>

        <!-- Admin Management -->
        <div class="section-title">Manage Admins</div>
        <div class="admin-section">
            <!-- Form -->
            <div class="admin-form">
                <h3 id="formTitle">Add Admin</h3>
                <div id="formStatus" class="status"></div>
                <form id="adminForm">
                    <div class="form-row">
                        <label for="adminName">Full name</label>
                        <input type="text" id="adminName" name="name" placeholder="Jane Doe" required>
                    </div>
                    <div class="form-row">
                        <label for="adminEmail">Email</label>
                        <input type="email" id="adminEmail" name="email" placeholder="jane@example.com" required>
                    </div>
                    <div class="form-row">
                        <label for="adminEmployeeId">Employee ID</label>
                        <input type="text" id="adminEmployeeId" name="employeeId" placeholder="EMP-001" required>
                    </div>
                    <div class="form-row">
                        <label for="adminRole">Role</label>
                        <input type="text" id="adminRole" name="role" placeholder="Admin" value="Admin" required>
                    </div>
                    <div class="form-row">
                        <button type="submit" class="btn" id="submitBtn">Add Admin</button>
                    </div>
                    <div class="form-row" id="cancelEditRow" style="display:none;">
                        <button type="button" class="btn secondary" id="cancelEditBtn">Cancel edit</button>
                    </div>
                </form>
            </div>

            <!-- List -->
            <div class="admin-list">
                <h3>Admin list</h3>
                <div id="adminListStatus" class="status"></div>
                <div id="adminGrid" class="admin-grid">
                    <div class="empty">Loading admins...</div>
                </div>
            </div>
        </div>

    </div>

<script>
    const API = "https://employeemanagement-production-a990.up.railway.app";

    let employees = [];
    let employeeEditingId = null;

    // Fetch employees for dashboard
    async function loadEmployees() {
        try {
            const res = await fetch(`${API}/employees`);
            const data = await res.json();

            const table = document.getElementById("employeeTable");

            if (!data.data || data.data.length === 0) {
                table.innerHTML = `<tr><td colspan="4" class="empty">No employees found</td></tr>`;
                employees = [];
                renderEmployeeCards();
                return;
            }

            // Update overview count
            document.getElementById("totalEmployees").textContent = data.data.length;
            employees = data.data;

            // Show only last 5 employees
            table.innerHTML = "";
            data.data.slice(-5).forEach(emp => {
                const dob = new Date(emp.dateOfBirth).toLocaleDateString();
                table.innerHTML += `
                    <tr>
                        <td>${emp.name}</td>
                        <td>${emp.email}</td>
                        <td>${emp.department}</td>
                        <td>${dob}</td>
                    </tr>
                `;
            });

            renderEmployeeCards();
        } catch (err) {
            console.error(err);
            setEmployeeListStatus("Could not load employees", "error");
        }
    }

    // Load dashboard data
    loadEmployees();

    // --- Admin management ---
    const adminGrid = document.getElementById("adminGrid");
    const adminListStatus = document.getElementById("adminListStatus");
    const formStatus = document.getElementById("formStatus");
    const adminForm = document.getElementById("adminForm");
    const formTitle = document.getElementById("formTitle");
    const submitBtn = document.getElementById("submitBtn");
    const cancelEditRow = document.getElementById("cancelEditRow");

    let admins = [];
    let editingId = null;

    function setFormStatus(message, type = "success") {
        formStatus.textContent = message;
        formStatus.className = `status ${type}`;
        if (message) {
            setTimeout(() => formStatus.textContent = "", 3000);
        }
    }

    function setListStatus(message, type = "success") {
        adminListStatus.textContent = message;
        adminListStatus.className = `status ${type}`;
        if (message) {
            setTimeout(() => adminListStatus.textContent = "", 3000);
        }
    }

    async function loadAdmins() {
        adminGrid.innerHTML = `<div class="empty">Loading admins...</div>`;
        try {
            const res = await fetch(`${API}/admins`);
            const data = await res.json();
            admins = data.data || [];
            renderAdmins();
            document.getElementById("totalAdmins").textContent = admins.length;
        } catch (err) {
            console.error(err);
            adminGrid.innerHTML = `<div class="empty">Could not load admins</div>`;
            setListStatus("Failed to fetch admins", "error");
        }
    }

    function renderAdmins() {
        if (!admins.length) {
            adminGrid.innerHTML = `<div class="empty">No admins yet</div>`;
            return;
        }

        adminGrid.innerHTML = "";
        admins.forEach(admin => {
            const card = document.createElement("div");
            card.className = "admin-card";
            card.innerHTML = `
                <h4>${admin.name}</h4>
                <div class="admin-meta">${admin.email}</div>
                <div class="admin-meta">ID: ${admin.employeeId || admin.id}</div>
                <div class="chip">${admin.role || "Admin"}</div>
                <div class="card-actions">
                    <button class="small-btn edit" data-id="${admin.id}">Edit</button>
                    <button class="small-btn remove" data-id="${admin.id}">Remove</button>
                </div>
            `;
            adminGrid.appendChild(card);
        });

        // wire buttons
        adminGrid.querySelectorAll(".small-btn.edit").forEach(btn => {
            btn.onclick = () => startEdit(btn.dataset.id);
        });
        adminGrid.querySelectorAll(".small-btn.remove").forEach(btn => {
            btn.onclick = () => removeAdmin(btn.dataset.id);
        });
    }

    function startEdit(id) {
        const admin = admins.find(a => String(a.id) === String(id));
        if (!admin) return;
        editingId = id;
        formTitle.textContent = "Edit Admin";
        submitBtn.textContent = "Update Admin";
        cancelEditRow.style.display = "block";
        adminForm.adminName.value = admin.name || "";
        adminForm.adminEmail.value = admin.email || "";
        adminForm.adminEmployeeId.value = admin.employeeId || admin.id || "";
        adminForm.adminRole.value = admin.role || "Admin";
        adminForm.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function resetForm() {
        editingId = null;
        formTitle.textContent = "Add Admin";
        submitBtn.textContent = "Add Admin";
        cancelEditRow.style.display = "none";
        adminForm.reset();
        adminForm.adminRole.value = "Admin";
    }

    async function removeAdmin(id) {
        if (!confirm("Remove this admin?")) return;
        try {
            const res = await fetch(`${API}/admins/${id}`, { method: "DELETE" });
            if (!res.ok) throw new Error("Delete failed");
            admins = admins.filter(a => String(a.id) !== String(id));
            renderAdmins();
            setListStatus("Admin removed", "success");
            document.getElementById("totalAdmins").textContent = admins.length;
        } catch (err) {
            console.error(err);
            setListStatus("Could not remove admin", "error");
        }
    }

    adminForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const payload = {
            name: adminForm.adminName.value.trim(),
            email: adminForm.adminEmail.value.trim(),
            employeeId: adminForm.adminEmployeeId.value.trim(),
            role: adminForm.adminRole.value.trim() || "Admin"
        };

        if (!payload.name || !payload.email || !payload.employeeId) {
            setFormStatus("Please fill all fields", "error");
            return;
        }

        try {
            submitBtn.disabled = true;
            submitBtn.textContent = editingId ? "Saving..." : "Adding...";

            const res = await fetch(editingId ? `${API}/admins/${editingId}` : `${API}/admins`, {
                method: editingId ? "PUT" : "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const data = await res.json();
            if (!res.ok) throw new Error(data.message || "Request failed");

            if (editingId) {
                admins = admins.map(a => String(a.id) === String(editingId) ? { ...a, ...payload, id: a.id } : a);
                setFormStatus("Admin updated", "success");
            } else {
                admins.push(data.data || payload);
                setFormStatus("Admin added", "success");
            }

            renderAdmins();
            document.getElementById("totalAdmins").textContent = admins.length;
            resetForm();
        } catch (err) {
            console.error(err);
            setFormStatus(err.message || "Unable to save admin", "error");
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = editingId ? "Update Admin" : "Add Admin";
        }
    });

    document.getElementById("cancelEditBtn").addEventListener("click", resetForm);

    // Initial admin load
    loadAdmins();

    // --- Employee management ---
    const employeeGrid = document.getElementById("employeeGrid");
    const employeeListStatus = document.getElementById("employeeListStatus");
    const employeeFormStatus = document.getElementById("employeeFormStatus");
    const employeeForm = document.getElementById("employeeForm");
    const employeeFormTitle = document.getElementById("employeeFormTitle");
    const employeeSubmitBtn = document.getElementById("employeeSubmitBtn");
    const employeeCancelRow = document.getElementById("employeeCancelRow");

    function setEmployeeFormStatus(message, type = "success") {
        employeeFormStatus.textContent = message;
        employeeFormStatus.className = `status ${type}`;
        if (message) setTimeout(() => employeeFormStatus.textContent = "", 3000);
    }

    function setEmployeeListStatus(message, type = "success") {
        employeeListStatus.textContent = message;
        employeeListStatus.className = `status ${type}`;
        if (message) setTimeout(() => employeeListStatus.textContent = "", 3000);
    }

    function renderEmployeeCards() {
        if (!employees.length) {
            employeeGrid.innerHTML = `<div class="empty">No employees found</div>`;
            return;
        }

        employeeGrid.innerHTML = "";
        employees.forEach(emp => {
            const card = document.createElement("div");
            card.className = "employee-card";
            const dob = emp.dateOfBirth ? new Date(emp.dateOfBirth).toLocaleDateString() : "";
            card.innerHTML = `
                <h4>${emp.name}</h4>
                <div class="meta">${emp.email}</div>
                <div class="meta">${emp.phone || ""}</div>
                <div class="meta">Dept: ${emp.department || ""}</div>
                <div class="meta">DOB: ${dob}</div>
                <div class="pill">${emp.department || "Employee"}</div>
                <div class="card-actions" style="margin-top:10px;">
                    <button class="small-btn edit" data-id="${emp.id}">Edit</button>
                    <button class="small-btn remove" data-id="${emp.id}">Remove</button>
                </div>
            `;
            employeeGrid.appendChild(card);
        });

        employeeGrid.querySelectorAll(".small-btn.edit").forEach(btn => {
            btn.onclick = () => startEditEmployee(btn.dataset.id);
        });
        employeeGrid.querySelectorAll(".small-btn.remove").forEach(btn => {
            btn.onclick = () => removeEmployee(btn.dataset.id);
        });
    }

    function startEditEmployee(id) {
        const emp = employees.find(e => String(e.id) === String(id));
        if (!emp) return;
        employeeEditingId = id;
        employeeFormTitle.textContent = "Edit Employee";
        employeeSubmitBtn.textContent = "Update Employee";
        employeeCancelRow.style.display = "block";
        employeeForm.empName.value = emp.name || "";
        employeeForm.empEmail.value = emp.email || "";
        employeeForm.empPhone.value = emp.phone || "";
        employeeForm.empDepartment.value = emp.department || "";
        employeeForm.empDob.value = emp.dateOfBirth ? String(emp.dateOfBirth).split("T")[0] : "";
        employeeForm.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    function resetEmployeeForm() {
        employeeEditingId = null;
        employeeFormTitle.textContent = "Add Employee";
        employeeSubmitBtn.textContent = "Add Employee";
        employeeCancelRow.style.display = "none";
        employeeForm.reset();
    }

    async function removeEmployee(id) {
        if (!confirm("Remove this employee?")) return;
        try {
            const res = await fetch(`${API}/employees/${id}`, { method: "DELETE" });
            if (!res.ok) throw new Error("Delete failed");
            employees = employees.filter(e => String(e.id) !== String(id));
            renderEmployeeCards();
            document.getElementById("totalEmployees").textContent = employees.length;
            setEmployeeListStatus("Employee removed", "success");
        } catch (err) {
            console.error(err);
            setEmployeeListStatus("Could not remove employee", "error");
        }
    }

    employeeForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const payload = {
            name: employeeForm.empName.value.trim(),
            email: employeeForm.empEmail.value.trim(),
            phone: employeeForm.empPhone.value.trim(),
            department: employeeForm.empDepartment.value.trim(),
            dateOfBirth: employeeForm.empDob.value
        };

        if (!payload.name || !payload.email || !payload.phone || !payload.department || !payload.dateOfBirth) {
            setEmployeeFormStatus("Please complete all fields", "error");
            return;
        }

        try {
            employeeSubmitBtn.disabled = true;
            employeeSubmitBtn.textContent = employeeEditingId ? "Saving..." : "Adding...";

            const res = await fetch(employeeEditingId ? `${API}/employees/${employeeEditingId}` : `${API}/employees`, {
                method: employeeEditingId ? "PUT" : "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });

            const data = await res.json();
            if (!res.ok) throw new Error(data.message || "Request failed");

            if (employeeEditingId) {
                employees = employees.map(e => String(e.id) === String(employeeEditingId) ? { ...e, ...payload, id: e.id } : e);
                setEmployeeFormStatus("Employee updated", "success");
            } else {
                const newEmp = data.data || { ...payload, id: Date.now() };
                employees.push(newEmp);
                setEmployeeFormStatus("Employee added", "success");
            }

            renderEmployeeCards();
            document.getElementById("totalEmployees").textContent = employees.length;
            resetEmployeeForm();
        } catch (err) {
            console.error(err);
            setEmployeeFormStatus(err.message || "Unable to save employee", "error");
        } finally {
            employeeSubmitBtn.disabled = false;
            employeeSubmitBtn.textContent = employeeEditingId ? "Update Employee" : "Add Employee";
        }
    });

    document.getElementById("employeeCancelBtn").addEventListener("click", resetEmployeeForm);
</script>

</body>
</html>

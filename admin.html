<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: #ddad75;
      padding: 30px;
      color: #27211c;
    }

    /* ===== LOGIN ===== */
    #loginBox {
      max-width: 700px;
      margin: 120px auto;
      background: #fff;
      padding: 60px;
      border-radius: 14px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }

    #loginBox h2 {
      color: #ff6a00;
      font-size: 50px;
      margin-bottom: 10px;
    }

    input,
    select {
      width: 100%;
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }

    /* ===== DASHBOARD ===== */
    #dashboard {
      display: none;
      max-width: 1200px;
      margin: auto;
    }

    /* ===== TOP BAR ===== */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .top-bar h1 {
      color: #f3f2eb;
    }

    .logout-btn {
      background: #111;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
    }

    /* ===== STATS ===== */
    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
    }

    .stat-card h3 {
      color: #eb890a;
      font-size: 28px;
    }

    /* ===== MAIN GRID ===== */
    .main {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
    }

    /* ===== EMPLOYEE LIST ===== */
    .employee-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 20px;
    }

    .employee-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
    }

    .employee-card h3 {
      color: #eb890a;
    }

    .actions {
      margin-top: 12px;
    }

    button {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }

    .edit-btn {
      background: #ff8c1a;
      color: white;
    }

    .remove-btn {
      background: #ef4444;
      color: white;
    }

    /* ===== FORM ===== */
    .form-box {
      background: rgb(238, 127, 36);
      padding: 20px;
      border-radius: 12px;
    }

    .form-box h2 {
      color: #fff;
      margin-bottom: 10px;
    }

    .save-btn {
      background: linear-gradient(135deg, #ff8c1a, #ff6a00);
      color: white;
      width: 100%;
      padding: 12px;
      border-radius: 10px;
    }

    .search-btn {
      background: #111;
      color: white;
      width: 100%;
      margin-bottom: 12px;
    }

    /* ===== ACTIVITY ===== */
    .activity {
      margin-top: 30px;
      background: white;
      padding: 20px;
      border-radius: 12px;
    }

    .activity li {
      font-size: 0.85rem;
      margin-bottom: 6px;
    }

    /* ===== MODALS ===== */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .modal-overlay.show {
      display: flex;
      opacity: 1;
    }

    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 14px;
      width: 90%;
      max-width: 500px;
      position: relative;
      transform: translateY(-20px);
      transition: transform 0.3s ease;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    }

    .modal-overlay.show .modal-content {
      transform: translateY(0);
    }

    .close-modal {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }

    .cancel-btn {
      background: #ccc;
      color: #333;
    }

    /* ===== SEARCH RESULTS ===== */
    #searchResults {
      margin-top: 10px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      display: none;
      /* Hidden by default */
    }

    .search-result-item {
      padding: 12px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .search-result-item:last-child {
      border-bottom: none;
    }

    .search-result-item:hover {
      background: #f9f9f9;
    }
  </style>
</head>

<body>

  <!-- LOGIN -->
  <div id="loginBox">
    <h2>Hello Maya Hive Admin</h2>
    <h3>Sign In</h3>
    <input id="email" placeholder="Admin Email">
    <input id="password" type="password" placeholder="Password">
    <button class="save-btn" onclick="login()">Login</button>
    <p id="error" style="color:red;"></p>
  </div>

  <!-- DASHBOARD -->
  <div id="dashboard">

    <div class="top-bar">
      <h1>Maya Hive Admin Dashboard</h1>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </div>

    <div class="stats">
      <div class="stat-card">
        <h3 id="totalEmployees">0</h3>
        <p>Total Employees</p>
      </div>
      <div class="stat-card">
        <h3 id="lastAction">â€”</h3>
        <p>Last Action</p>
      </div>
      <div class="stat-card">
        <h3>Admin</h3>
        <p>Role</p>
      </div>
    </div>

    <div class="main">

      <!-- EMPLOYEES -->
      <div class="employee-grid" id="employeeGrid"></div>

      <div class="form-box">
        <h2>Actions</h2>
        <button class="save-btn" onclick="openEmployeeModal()" style="margin-bottom: 20px;">+ Add New Employee</button>

        <h3>Search</h3>
        <input id="searchIdInput" placeholder="Enter Employee ID">
        <button class="search-btn" onclick="searchEmployee()">Search</button>
        <div id="searchResults"></div>
      </div>

    </div>

    <div class="activity">
      <h2>Activity Log</h2>
      <ul id="activityLog"></ul>
    </div>

  </div>

  <!-- EMPLOYEE MODAL -->
  <div id="employeeModal" class="modal-overlay">
    <div class="modal-content">
      <span class="close-modal" onclick="closeModal('employeeModal')">&times;</span>
      <h2 id="modalTitle">Add Employee</h2>

      <input type="hidden" id="empId">
      <input id="empName" placeholder="Name">
      <input id="empEmail" placeholder="Email">
      <input id="empPhone" placeholder="Phone">
      <input id="empDob" type="date" placeholder="Date of Birth">

      <select id="empDepartment">
        <option value="">Select Department</option>
        <option>Engineering</option>
        <option>Sales</option>
        <option>Marketing</option>
        <option>HR</option>
      </select>

      <div class="modal-actions">
        <button class="cancel-btn" onclick="closeModal('employeeModal')">Cancel</button>
        <button class="save-btn" onclick="saveEmployee()">Save</button>
      </div>
    </div>
  </div>

  <!-- CONFIRMATION MODAL -->
  <div id="confirmModal" class="modal-overlay">
    <div class="modal-content">
      <h2 id="confirmTitle">Are you sure?</h2>
      <p id="confirmMessage">Do you want to proceed?</p>
      <div class="modal-actions">
        <button class="cancel-btn" onclick="closeModal('confirmModal')">No</button>
        <button class="remove-btn" id="confirmYesBtn">Yes</button>
      </div>
    </div>
  </div>

  <script>
    const API = "https://employeemanagement-production-a990.up.railway.app";

    /* ================= AUTH ================= */
    function login() {
      if (email.value === "admin@maya.com" && password.value === "1234") {
        localStorage.setItem("admin", "true");
        showDashboard();
        logActivity("Admin logged in");
      } else {
        error.innerText = "Invalid admin credentials";
      }
    }

    function logout(confirm = false) {
      if (!confirm) {
        openConfirmModal("Logout", "Are you sure you want to logout?", () => logout(true));
        return;
      }
      localStorage.removeItem("admin");
      location.reload();
    }

    if (localStorage.getItem("admin")) showDashboard();

    function showDashboard() {
      loginBox.style.display = "none";
      dashboard.style.display = "block";
      loadEmployees();

      // Close modals on outside click
      window.onclick = function (event) {
        if (event.target.classList.contains('modal-overlay')) {
          event.target.classList.remove('show');
          setTimeout(() => event.target.style.display = 'none', 300);
        }
      }
    }

    /* ================= MODALS ================= */
    function openModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.style.display = 'flex';
      // tiny delay to allow display flex to apply before opacity transition
      setTimeout(() => modal.classList.add('show'), 10);
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      modal.classList.remove('show');
      setTimeout(() => modal.style.display = 'none', 300);
    }

    function openEmployeeModal() {
      clearForm();
      document.getElementById('modalTitle').innerText = "Add Employee";
      openModal('employeeModal');
    }

    function openConfirmModal(title, msg, onYes) {
      document.getElementById('confirmTitle').innerText = title;
      document.getElementById('confirmMessage').innerText = msg;

      const yesBtn = document.getElementById('confirmYesBtn');
      // Remove old listeners to avoid stacking
      const newYesBtn = yesBtn.cloneNode(true);
      yesBtn.parentNode.replaceChild(newYesBtn, yesBtn);

      newYesBtn.onclick = () => {
        onYes();
        closeModal('confirmModal');
      };

      openModal('confirmModal');
    }

    /* ================= ACTIVITY ================= */
    function logActivity(msg) {
      const time = new Date().toLocaleString();
      activityLog.innerHTML =
        `<li>[${time}] ${msg}</li>` + activityLog.innerHTML;
      lastAction.innerText = msg;
    }

    /* ================= LOAD EMPLOYEES ================= */
    async function loadEmployees() {
      try {
        const res = await fetch(`${API}/employees`);
        const json = await res.json();

        if (!json.data) throw "Invalid API response";

        employeeGrid.innerHTML = "";
        totalEmployees.innerText = json.data.length;

        json.data.forEach(emp => {
          employeeGrid.innerHTML += renderEmployeeCard(emp);
        });
      } catch (err) {
        // alert("Failed to load employees. Check API.");
        console.error(err);
      }
    }

    function renderEmployeeCard(emp) {
      return `
        <div class="employee-card">
          <h3>${emp.name}</h3>
          <p style="font-size: 0.9em; color: #666;">ID: ${emp.id}</p>
          <p>${emp.email}</p>
          <p>${emp.phone}</p>
          <p>${emp.department}</p>
          <div class="actions">
            <button class="edit-btn" onclick="loadEmployeeToForm('${emp.id}')">Edit</button>
            <button class="remove-btn" onclick="removeEmployee('${emp.id}')">Remove</button>
          </div>
        </div>
      `;
    }

    /* ================= SEARCH / EDIT ================= */
    async function searchEmployee() {
      const id = searchIdInput.value;
      if (!id) {
        alert("Enter Employee ID");
        return;
      }

      try {
        const res = await fetch(`${API}/employees/${id}`);
        const json = await res.json();

        if (!json.data) throw "Employee not found";

        // Show result in searchResults container
        const resultsDiv = document.getElementById('searchResults');
        resultsDiv.style.display = 'block';
        resultsDiv.innerHTML = `
          <div class="search-result-item">
            <div>
              <strong>${json.data.name}</strong> (${json.data.department})<br>
              <small>${json.data.email}</small>
            </div>
            <button class="edit-btn" onclick="loadEmployeeToForm('${json.data.id}')">Edit</button>
          </div>
        `;

      } catch (err) {
        document.getElementById('searchResults').style.display = 'block';
        document.getElementById('searchResults').innerHTML = `<div class="search-result-item" style="color:red;">Employee not found</div>`;
      }
    }

    async function loadEmployeeToForm(id) {
      try {
        const res = await fetch(`${API}/employees/${id}`);
        const json = await res.json();

        if (!json.data) throw "Employee not found";

        fillForm(json.data);
        document.getElementById('modalTitle').innerText = "Edit Employee";
        openModal('employeeModal');
        logActivity(`Loaded employee ${json.data.name} for edit`);
      } catch (err) {
        alert("Employee not found");
      }
    }

    /* ================= FORM FILL ================= */
    function fillForm(emp) {
      document.getElementById('empId').value = emp.id;
      document.getElementById('empName').value = emp.name;
      document.getElementById('empEmail').value = emp.email;
      document.getElementById('empPhone').value = emp.phone;
      document.getElementById('empDob').value = emp.dateOfBirth ? emp.dateOfBirth.split('T')[0] : '';
      document.getElementById('empDepartment').value = emp.department;
    }

    /* ================= SAVE ================= */
    async function saveEmployee() {
      const empIdVal = document.getElementById('empId').value;
      const payload = {
        name: document.getElementById('empName').value,
        email: document.getElementById('empEmail').value,
        phone: document.getElementById('empPhone').value,
        dateOfBirth: document.getElementById('empDob').value,
        department: document.getElementById('empDepartment').value
      };

      try {
        if (empIdVal) {
          await fetch(`${API}/employees/${empIdVal}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });
          logActivity("Employee updated");
        } else {
          await fetch(`${API}/employees`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
          });
          logActivity("New employee added");
        }

        closeModal('employeeModal');
        loadEmployees();
      } catch (err) {
        alert("Save failed");
        console.error(err);
      }
    }

    /* ================= CLEAR ================= */
    function clearForm() {
      document.getElementById('empId').value = "";
      document.getElementById('empName').value = "";
      document.getElementById('empEmail').value = "";
      document.getElementById('empPhone').value = "";
      document.getElementById('empDob').value = "";
      document.getElementById('empDepartment').value = "";
    }

    /* ================= REMOVE ================= */
    function removeEmployee(id) {
      openConfirmModal("Remove Employee", "Are you sure you want to remove this employee?", async () => {
        try {
          await fetch(`${API}/employees/${id}`, { method: "DELETE" });
          logActivity("Employee removed");
          loadEmployees();
        } catch (err) {
          alert("Delete failed");
        }
      });
    }
  </script>

</body>

</html>